---
output: github_document
bibliography: ./man/ref/ref.bib
csl: ./man/ref/the-lancet.csl
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# MicroMeta: Meta-analysis version of QCAT


I provide a meta-analysis framework for Microbiome data sets from different studies based on the summary statistics generated by Quasi-Conditional Association (QCAT) tests[@tang2017general]. The meta-analysis methods in this package include fixed effect tests, for example, the FE-MV test and FE-VC test, and random effect tests, like, Het-SKAT and RE-SKAT test[@lee2013general]. If the taxonomic hierarchy is provided, the tests will be performed on the taxonomic tree to localize the covariate-associated lineages.

*MicroMeta* comes with four datasets: data.meta, count.genus, meta and tax. The data.meta dataset follows the structure of *QCAT_Meta* and *QCAT_GEE_Meta* functions are designed. And data.meta\$OTU and data.meta\$covariate are both lists contains 5 elements which are the OTU counts and covariate of interest from different sources. Meanwhile, data.meta, count.genus, meta and tax are the raw data sets of data.meta. 

## Installation
You can install the development version from [GitHub](https://github.com/DriWater/MicroMeta) with:

``` r
# Plain installation
# install.packages("devtools")
devtools::install_github("DriWater/MicroMeta")

# For installation with vignette
devtools::install_github("DriWater/MicroMeta", build_vignettes = TRUE)
```

## Example
```{r fig.width=6, fig.height=6, fig.align='center',eval=FALSE}
library(MicroMeta)
data("data.meta")
head(data.meta$Tax)
head(data.meta$OTU[[1]])
head(data.meta$covariate[[1]])
```

## QCAT_Meta

##### Fixed effect Meta-analysis method based on QCAT test with asymptotic p-value. (Tax Provided)
```{r fig.width=6, fig.height=6, fig.align='center',eval=FALSE}
Method = "FE-MV"
one_part_MV <- QCAT_Meta(data.meta$OTU, data.meta$covariate, 1, Tax = data.meta$Tax, Method = Method, n.perm = NULL)
one_part_MV
```


##### Random effect Meta-analysis method based on QCAT test with permutation p-value performed on lineage.

```{r fig.width=6, fig.height=6, fig.align='center',eval = F}
Method = "Het-SKAT"
one_part_Het <- QCAT_Meta(data.meta$OTU, data.meta$covariate, 1, Tax = NULL, Method = Method, n.perm = 1000, use.cpp = T)
one_part_Het
```

For OTU table with excessive zero counts, we also employ the generalized estimating equation (GEE) method to estimate the zero part of estimate equations. 

## QCAT_GEE_Meta

##### Fixed effect Meta-analysis method based on QCAT_GEE test with asymptotic p-value performed on lineage.
```{r fig.width=6, fig.height=6, fig.align='center',eval = F}
Method = "FE-VC"
zero_part_MV <- QCAT_GEE_Meta(data.meta$OTU, data.meta$covariate, 1, Tax = NULL, Method = Method, n.perm = NULL)
zero_part_MV 
```


##### Random effect Meta-analysis method based on QCAT_GEE test with permutation p-value. (Tax provided)
```{r fig.width=6, fig.height=6, fig.align='center',eval = F}
Method = "RE-SKAT"
zero_part_RE <- QCAT_GEE_Meta(data.meta$OTU, data.meta$covariate, 1, Tax = data.meta$Tax, Method = Method, n.perm = 200, use.cpp = T)
zero_part_RE
```

## References:
